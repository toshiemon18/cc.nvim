# cc.nvim - Claude Code Neovim連携 要件ドキュメント

## 1. プロジェクト概要

### 目的
NeovimでClaude Code CLIをターミナル経由で実行し、シンプルで確実な連携を提供する。

### 設計方針
- 最小限の機能に集中
- 確実な動作を優先
- 設定可能性を重視

## 2. 機能要件

### 2.1 ターミナル表示・配置
- **分割方式**: 水平分割（上下）
- **位置**: 下部に新規バッファを開く
- **高さ**: 画面全体の20%
- **設定**: 後々、高さと分割方式（水平/垂直）を設定で調整可能

### 2.2 基本操作
- **コマンド**: `plugin/cc_nvim.lua`で定義されたコマンドを使用
  - 実装に応じて新たなコマンド・命名に変更可能
- **操作**: ターミナルの開閉・トグル機能
- **制限**: 複数ターミナルは開かない（単一インスタンス）

### 2.3 プロセス管理
- **開始**: コマンド実行時にClaude Code CLIを起動
- **終了**: バッファを閉じた時にプロセスを終了
- **状態管理**: 単一のターミナルインスタンスのみ管理

## 3. 非機能要件

### 3.1 除外する機能
- ファイル送信機能
- テキスト選択送信機能
- AIコーディングツール（Cursor等）類似の機能
- ターミナル内カスタムキーマップ
- Claude Code拡張設定

### 3.2 設定可能項目
- Claude Code実行コマンド
- バッファ高さ（％指定）
- 分割方式（水平/垂直）

## 4. 技術仕様

### 4.1 実装方式
- Neovim terminal機能使用（`vim.fn.termopen`）
- 水平分割でバッファ作成
- プロセス管理とバッファ状態の確実な同期

### 4.2 ファイル構成
```
lua/cc_nvim/
├── init.lua          # メインAPI
├── config.lua        # 設定管理
└── terminal.lua      # ターミナル管理
```

### 4.3 設定例
```lua
require("cc_nvim").setup({
  claude_executable = "claude",  -- Claude Code実行コマンド
  terminal = {
    position = "bottom",         -- "bottom" | "top"
    size = 20,                   -- 画面に対する％
    split_type = "horizontal"    -- "horizontal" | "vertical"
  }
})
```

## 5. 実装優先度

### Phase 1: 基本機能
1. ターミナル開閉機能
2. 単一インスタンス管理
3. プロセス終了処理

### Phase 2: 設定機能
1. 設定ファイル対応
2. カスタマイズ可能項目の実装

### Phase 3: 改善
1. エラーハンドリング強化
2. 安定性向上